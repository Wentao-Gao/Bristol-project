%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2022 Jan %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%  WENTAO GAO &&& JINGZHI WU %%%%%%%%%%%%%%%%%%%%%%%%%%%


%%% initialization %%%
clear all;
clc;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% parameters %%%

for i=1:3 
ra(i) =170;  
end

L=130; 
Rplat=130; 
Rbase=290; 

PB1=pi/2;
PB2=pi+pi/6;
PB3=2*pi-pi/6;
PP1=pi/2;
PP2=pi+pi/6;
PP3=2*pi-pi/6;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% input the known parameters Xc,Yc,alpha %%%
Xc = input('X(mm) : ');
Yc = input('Y(mm) :  ');
alpha = input('alpha(Â°) :  ');
a = alpha*pi/180;

P=[0,0,0;
   0,0,0];
B=[0,0,0;
   0,0,0];
PB2PP=[0,0,0;
       0,0,0];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% calculate the PB2PP %%%
for i=1:3
    P(1,i)=-Rplat*cos((30+a+120*(i-1))*(pi()/180))+Xc;
    P(2,i)=-Rplat*sin((30+a+120*(i-1))*(pi()/180))+Yc;

    B(1,i)=-Rbase*cos((210+120*(i-1))*(pi()/180));
    B(2,i)=-Rbase*sin((210+120*(i-1))*(pi()/180));

    PB2PP(1,i)=B(1,i)+P(1,i);
    PB2PP(2,i)=B(2,i)+P(2,i);
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% set intermediate parameters %%%
Theta=[0,0,0];
t=[0,0,0];

e1=[0,0,0];
e2=[0,0,0];
e3=[0,0,0];

for i=1:3
    e1(i)=-2*PB2PP(2,i)*ra(i);
    e2(i)=-2*PB2PP(1,i)*ra(i);
    e3(i)=(PB2PP(1,i))^2+(PB2PP(2,i))^2+ra(i)^2-L^2;
    t(i)=(-e1(i)+sqrt((e1(i))^2+(e2(i))^2-(e3(i))^2))/(e3(i)-e2(i));
    Theta(i)=2*atan(t(i));
  if e1(i)^2+e2(i)^2-e3(i)^2 < 0 
    disp(' input error !')
  return
 end
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% calculate joint positions %%%
J=[0,0,0;
   0,0,0];
for i=1:3
    J(1,i)=-B(1,i)+ra(i)*cos(Theta(i));
    J(2,i)=-B(2,i)+ra(i)*sin(Theta(i));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% plot the platform %%%
plat=[P(1,:) P(1,1);P(2,:) P(2,1)];
line(plat(1,:),plat(2,:), 'Color', 'g');
hold on

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% plot the base %%% 
base=[-B(1,:) -B(1,1);-B(2,:) -B(2,1)];
line(base(1,:),base(2,:), 'Color', 'r');

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% plot the three links %%%
links1=[-B(1,1) J(1,1) P(1,1);-B(2,1) J(2,1) P(2,1)];
links2=[-B(1,2) J(1,2) P(1,2);-B(2,2) J(2,2) P(2,2)];
links3=[-B(1,3) J(1,3) P(1,3);-B(2,3) J(2,3) P(2,3)];
plot(links1(1,:),links1(2,:),'k-^','linewidth',1);
plot(links2(1,:),links2(2,:),'k-^','linewidth',1);
plot(links3(1,:),links3(2,:),'k-^','linewidth',1);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% plot the points %%%
plot(Xc,Yc,'g*');
plot(0,0,'r*');
xlabel('x-axis')
ylabel('y-axis')

axis equal
grid on
hold off

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
